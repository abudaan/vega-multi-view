<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="stylesheet" href="/vega-multi-view/css/main.css">
</head>

<body>
    <section>
    <div>
    <h3 id="data-binding-between-views">Data binding between views</h3>

<p>You can send a dataset or a manipulation of a dataset between separate views by adding a key <code class="highlighter-rouge">dataset</code> to you view specific configuration (vmv config). The code examples below are related to <a href="http://app3.bigdator.nl/">this example</a> and dataset that we use is named <code class="highlighter-rouge">table</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">A</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">28</span>
<span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">B</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">55</span>
<span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">C</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">43</span>
<span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">D</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">91</span>
<span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">E</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">81</span>
<span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">F</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">53</span>
<span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">G</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">19</span>
<span class="pi">-</span> <span class="na">category</span><span class="pi">:</span> <span class="s">H</span>
  <span class="na">amount</span><span class="pi">:</span> <span class="s">87</span>
</code></pre></div></div>

<h4 id="1-replace-a-complete-dataset">1. replace a complete dataset</h4>

<p>Your vmv config would look something like this:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">publish</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">signal</span><span class="pi">:</span> <span class="s">exportData</span>
  <span class="na">as</span><span class="pi">:</span> <span class="s">updateDataFromView1</span>
  <span class="na">dataset</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">table</span>
    <span class="na">action</span><span class="pi">:</span> <span class="s">replace_all</span>
</code></pre></div></div>

<p>And your then <code class="highlighter-rouge">exportData</code> signal should hold the complete <code class="highlighter-rouge">table</code> dataset:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">signals</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">exportData</span>
  <span class="na">value</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="s1">'</span><span class="s">on'</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">events</span><span class="pi">:</span>
      <span class="na">signal</span><span class="pi">:</span> <span class="s">changeAmount</span>
    <span class="na">update</span><span class="pi">:</span> <span class="s2">"</span><span class="s">data('table')"</span>
</code></pre></div></div>

<h4 id="2-change-selected-values">2. change selected values</h4>

<p>The vmv config:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">publish</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">signal</span><span class="pi">:</span> <span class="s">exportData</span>
  <span class="na">as</span><span class="pi">:</span> <span class="s">updateDataFromView1</span>
  <span class="na">dataset</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">table</span>
    <span class="na">action</span><span class="pi">:</span> <span class="s">change</span>
    <span class="na">select</span><span class="pi">:</span>
      <span class="na">field</span><span class="pi">:</span> <span class="s">category</span>
      <span class="na">test</span><span class="pi">:</span> <span class="s2">"</span><span class="s">=="</span>
    <span class="na">update</span><span class="pi">:</span>
      <span class="na">fields</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">amount</span>
</code></pre></div></div>

<p>As you can see the <code class="highlighter-rouge">action</code> is set to “change”; now the <code class="highlighter-rouge">dataset</code> object behaves like a sort of SQL query that selects rows and updates values of fields in the selected rows.</p>

<p>The <code class="highlighter-rouge">select</code> object tells us how to select the right data row in the dataset. In this example we want to select a row by category so <code class="highlighter-rouge">field</code> is set to “category” and <code class="highlighter-rouge">test</code> is set to “==”. The value that we are going to test against will be provided by the signal, see below.</p>

<p>Then we have an <code class="highlighter-rouge">update</code> object, in this object we list the field(s) in the data row that will be replaced by the new value(s). These values will be provided by the signal as well. In this case we have only 2 fields in a data row and we only want to update the field “amount” of the selected category.</p>

<p>Now let’s have a look at the spec to see how the signal sets the necessary values:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">signals</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">exportData</span>
  <span class="na">value</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="s1">'</span><span class="s">on'</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">events</span><span class="pi">:</span>
      <span class="na">signal</span><span class="pi">:</span> <span class="s">changeAmount</span>
    <span class="na">update</span><span class="pi">:</span> <span class="s2">"</span><span class="s">[[category,</span><span class="nv"> </span><span class="s">changeAmount.amount],</span><span class="nv"> </span><span class="s">['A',</span><span class="nv"> </span><span class="s">changeAmount.amount</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">0.2]]"</span>
</code></pre></div></div>

<p>Let’s break down the last line into json:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="s2">"category"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"changeAmount.amount"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="s2">"A"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"changeAmount.amount * 0.2"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
<p>and into yaml:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="pi">-</span> <span class="s">category</span>
  <span class="pi">-</span> <span class="s">changeAmount.amount</span>
<span class="pi">-</span> <span class="pi">-</span> <span class="s">A</span>
  <span class="pi">-</span> <span class="s">changeAmount.amount * 0.2</span>
</code></pre></div></div>

<p>Now you can clearly see the signal is an array of tuples.</p>

<p>The first value of every tuple is the value that will be used for the test. The second and subsequent values are the new values of the fields that will be updated. In this example we only update the <code class="highlighter-rouge">amount</code> field, so the tuples have only 2 values.</p>

<p>In the first tuple we test against the value of the <code class="highlighter-rouge">category</code> signal which is the currently selected category. In the second tuple we simply select category “A”.</p>

<p>In the first tuple we set the value of the currently selected category to the current value of the <code class="highlighter-rouge">amount</code> key of the <code class="highlighter-rouge">changeAmount</code> signal. In the second tuple we set the amount of category A to a fraction of this value.</p>

<p>As you can see, the vmv config provides the logic and the spec provides the values that this logic acts upon.</p>

</div>

    <section>
</body>

</html>
